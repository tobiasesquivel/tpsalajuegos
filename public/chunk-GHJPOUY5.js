import{a as B,c as z,g as W,s as A}from"./chunk-C3KL25CK.js";import{a as u}from"./chunk-HXP6K52P.js";import{j as E,k as F,n as D,o as T,p as N}from"./chunk-HW2YZ5O7.js";import{Ea as j,Ja as M,K as C,P as _,Ra as g,Ua as r,Va as i,ab as h,bb as x,fb as p,g as b,gb as f,hb as S,ib as y,jb as O,kb as P,nb as w,ob as v,pb as k,qb as I,ua as c,za as d}from"./chunk-AOP3JIL5.js";import"./chunk-X5YLR3NI.js";import{i as s}from"./chunk-ODN5LVDJ.js";var m=class a{constructor(t){this.supabaseService=t;this.cargarMensajes(),this.suscribirseTiempoReal()}mensajes=new b([]);mensajes$=this.mensajes.asObservable();subscription;cargarMensajes(){return s(this,null,function*(){try{let{data:t,error:e}=yield this.supabaseService.getCliente().from("mensajes_chat").select(`
          texto,
          fecha,
          usuario_id,
          usuarios:usuario_id (
            nombreusuario
          )
        `).order("fecha",{ascending:!0});if(e)throw e;let n=t.map(o=>({usuario:o.usuarios?.nombreusuario,usuario_id:o.usuario_id,texto:o.texto,fecha:new Date(o.fecha)}));this.mensajes.next(n)}catch(t){console.error("Error al cargar mensajes:",t)}})}suscribirseTiempoReal(){return s(this,null,function*(){let t=this.supabaseService.getCliente();this.subscription=t.channel("mensajes_chat_changes").on("postgres_changes",{event:"*",schema:"public",table:"mensajes_chat"},()=>{this.cargarMensajes()}).subscribe()})}enviarMensaje(t){return s(this,null,function*(){try{let e=yield this.supabaseService.getSession();if(!e?.user)return;let{error:n}=yield this.supabaseService.getCliente().from("mensajes_chat").insert([{usuario_id:e.user.id,texto:t}]);if(n)throw n}catch(e){console.error("Error al enviar mensaje:",e)}})}static \u0275fac=function(e){return new(e||a)(_(u))};static \u0275prov=C({token:a,factory:a.\u0275fac,providedIn:"root"})};var $=a=>({"mensaje-propio":a});function q(a,t){if(a&1&&(r(0,"div",7)(1,"div",8)(2,"span",9),p(3),i(),r(4,"span",10),p(5),v(6,"date"),i()(),r(7,"div",11),p(8),i()()),a&2){let e=t.$implicit,n=x();g("ngClass",w(7,$,e.usuario_id===n.usuarioId)),c(3),f(e.usuario),c(2),f(I(6,4,e.fecha,"short")),c(3),S(" ",e.texto," ")}}var R=class a{constructor(t,e){this.chatService=t;this.supabaseService=e}nuevoMensaje="";usuarioId=null;ngOnInit(){return s(this,null,function*(){let t=yield this.supabaseService.getSession();this.usuarioId=t?.user?.id||null})}enviarMensaje(){return s(this,null,function*(){this.nuevoMensaje.trim()&&(yield this.chatService.enviarMensaje(this.nuevoMensaje),this.nuevoMensaje="",this.recargarMensajes())})}recargarMensajes(){this.chatService.cargarMensajes()}static \u0275fac=function(e){return new(e||a)(d(m),d(u))};static \u0275cmp=j({type:a,selectors:[["app-chat"]],decls:11,vars:4,consts:[[1,"chat-container"],[1,"chat-header"],[1,"chat-messages"],["class","mensaje",3,"ngClass",4,"ngFor","ngForOf"],[1,"chat-input"],["type","text","placeholder","Escribe un mensaje...",3,"ngModelChange","keyup.enter","ngModel"],[3,"click"],[1,"mensaje",3,"ngClass"],[1,"mensaje-header"],[1,"usuario"],[1,"fecha"],[1,"mensaje-texto"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"h2"),p(3,"Sala de Chat"),i()(),r(4,"div",2),M(5,q,9,9,"div",3),v(6,"async"),i(),r(7,"div",4)(8,"input",5),P("ngModelChange",function(l){return O(n.nuevoMensaje,l)||(n.nuevoMensaje=l),l}),h("keyup.enter",function(){return n.enviarMensaje()}),i(),r(9,"button",6),h("click",function(){return n.enviarMensaje()}),p(10,"Enviar"),i()()()),e&2&&(c(5),g("ngForOf",k(6,2,n.chatService.mensajes$)),c(3),y("ngModel",n.nuevoMensaje))},dependencies:[N,E,F,D,T,A,B,z,W],styles:[".chat-container[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;background-color:var(--paneles);box-shadow:0 4px 20px var(--sombra-sutil);border-radius:8px;overflow:hidden;display:flex;flex-direction:column;height:600px}.chat-header[_ngcontent-%COMP%]{background-color:var(--color-primario);color:#fff;padding:1rem;text-align:center}.chat-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:1rem}.mensaje[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:.8rem;border-radius:8px;max-width:80%;margin-left:0;margin-right:auto}.mensaje-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem;font-size:.9rem}.usuario[_ngcontent-%COMP%]{font-weight:700;color:var(--color-primario)}.fecha[_ngcontent-%COMP%]{color:#666}.mensaje-texto[_ngcontent-%COMP%]{word-break:break-word}.chat-input[_ngcontent-%COMP%]{padding:1rem;background-color:#f5f5f5;display:flex;gap:1rem}.chat-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:.8rem;border:1px solid #ddd;border-radius:4px;font-size:1rem}.chat-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.8rem 1.5rem;background-color:var(--color-primario);color:#fff;border:none;border-radius:4px;cursor:pointer;transition:background-color .3s}.chat-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#303f9f}.mensaje-propio[_ngcontent-%COMP%]{background-color:var(--color-primario);color:#fff;margin-left:auto;margin-right:0;text-align:right}.mensaje-propio[_ngcontent-%COMP%]   .usuario[_ngcontent-%COMP%]{color:#fff}.mensaje-propio[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%]{color:#e0e0e0}"]})};export{R as ChatComponent};
